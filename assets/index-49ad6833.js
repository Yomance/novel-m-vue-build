import{d as w,s as P,o as r,c as p,b as i,e as s,w as d,u as f,t as x,F as $,p as F,q as R,_ as E,j as C,g as b,l as y,m as S,f as Y,v as j,x as q,r as g}from"./index-b21a5062.js";import{S as z}from"./StatusBar-8e440bdb.js";import{m as A,G as J,a as K}from"./router-88c881d4.js";import{u as N}from"./index-9167eec7.js";import{E as M}from"./index-551b3d01.js";import{B as T,L as O,P as Q}from"./index-1ab0a0de.js";import{I as W}from"./file-5968fc18.js";import{g as X,r as Z}from"./bookshelf-37f044eb.js";import{a as ee}from"./page-4b432e77.js";import{N as te}from"./index-b72d0545.js";import{s as se}from"./function-call-eb60fd77.js";import"./use-id-c0295969.js";const oe=n=>(F("data-v-c51fc16b"),n=n(),R(),n),ne={class:"header"},ae={class:"header-fixed"},le={class:"times"},ie={class:"left"},re={class:"time"},ue={class:"desc"},de=oe(()=>i("button",{class:"right"},null,-1)),ce=w({__name:"hrader",props:{bgc:{type:String,default:""}},emits:["edit"],setup(n,{emit:u}){P(c=>({"325d8947":n.bgc}));const _=N();return(c,t)=>{const a=z,e=J,l=K;return r(),p($,null,[i("div",ne,[i("div",ae,[s(a),s(l,{border:!1,"column-num":"3","icon-size":"20"},{default:d(()=>[s(e,{to:{name:"Search"},icon:"search",text:"搜索"}),s(e,{icon:"underway-o",text:"历史",onClick:t[0]||(t[0]=k=>f(A)({name:"History"}))}),s(e,{icon:"edit",text:"编辑",onClick:t[1]||(t[1]=k=>u("edit"))})]),_:1})])]),s(a),i("div",le,[i("div",ie,[i("div",re,x(f(_).readTimeString),1),i("div",ue,x(f(_).readTimeDesc),1)]),de])],64)}}});const _e=E(ce,[["__scopeId","data-v-c51fc16b"]]),me={key:1,style:{width:"100%",height:"100%"}},pe=w({__name:"empty",props:{show:{type:String}},setup(n){let u=C();return(_,c)=>{const t=T,a=M,e=O;return n.show==="nologin"?(r(),b(a,{key:0,description:"登陆后查看书架",image:"error"},{default:d(()=>[s(t,{round:"",style:{width:"200px"},type:"primary",onClick:c[0]||(c[0]=l=>f(u).push({name:"Login"}))},{default:d(()=>[y("去登陆")]),_:1})]),_:1})):n.show==="loading"?(r(),p("button",me,[s(e,{size:"24px"},{default:d(()=>[y("加载中...")]),_:1})])):n.show==="empty"?(r(),b(a,{key:2,description:"空荡荡的书架等你来填满"},{default:d(()=>[s(t,{round:"",size:"small",style:{width:"100px"},type:"danger",onClick:c[1]||(c[1]=l=>f(u).push({name:"Home"}))},{default:d(()=>[y("去书城 ")]),_:1})]),_:1})):S("",!0)}}}),ve={class:"book-list"},fe=["onClick"],he=["alt","src"],ge={class:"name van-multi-ellipsis--l2"},ye=w({__name:"book-list",props:{isEdit:{type:Boolean,default:!1},list:{type:Array,default:[]},selectIds:{type:Set,default:new Set}},emits:["update:isEdit","click"],setup(n,{emit:u}){const _=C();return(c,t)=>{const a=W;return r(),p("div",ve,[(r(!0),p($,null,Y(n.list,e=>(r(),p("div",{class:"item",onClick:l=>u("click",e)},[i("img",{alt:e.name,src:e.cover},null,8,he),i("div",ge,x(e.name),1),n.isEdit?(r(),p("button",{key:0,class:j([{active:n.selectIds.has(e.id)},"select"])},[s(a,{name:"success",size:"18"})],2)):S("",!0)],8,fe))),256)),n.isEdit?S("",!0):(r(),p("button",{key:0,class:"more",onClick:t[0]||(t[0]=e=>f(_).push({name:"Home"}))},[s(a,{name:"plus",size:"35"})]))])}}});const ke=E(ye,[["__scopeId","data-v-6815d59f"]]),be={class:"body"},we={style:{display:"flex"}},He=w({__name:"index",setup(n){let u=N();const _=q(()=>u.isLogin?l.value?"loading":a.value.length==0?"empty":"normal":"nologin"),c=C(),t=g(new Set),a=g([]),e=g(!1),l=g(!0),k=g(""),h=o=>{se({message:o,position:"bottom"})},I=()=>{u.isLogin&&(l.value=!0,X().then(o=>a.value=o).catch(({message:o})=>h(o)).finally(()=>l.value=!1))};I();const V=o=>k.value=o.target.scrollTop<=10?"":"#ffffff",H=()=>{if(!u.isLogin)return h("请先登录");if(a.value.length==0)return h("书架空空如也");t.value.clear(),e.value=!0},U=o=>{if(!l.value){if(!e.value)return ee(o.id,o.readTo);t.value.has(o.id)?t.value.delete(o.id):t.value.add(o.id)}},D=()=>{l.value=!0,Z([...t.value.values()]).then(o=>(h("删除成功！"),e.value=!1,I())).catch(({message:o})=>h(o)).finally(()=>l.value=!1)};return c.onBack=()=>e.value?(e.value=!1,!1):!0,(o,m)=>{const G=te,L=Q,B=T;return r(),p($,null,[i("div",{class:"bookshelf-view",onScroll:V},[s(_e,{onEdit:H,bgc:k.value},null,8,["bgc"]),i("div",be,[_.value==="normal"?(r(),b(ke,{key:0,onClick:U,list:a.value,"is-edit":e.value,"onUpdate:isEdit":m[0]||(m[0]=v=>e.value=v),"select-ids":t.value},null,8,["list","is-edit","select-ids"])):(r(),b(pe,{key:1,show:_.value},null,8,["show"]))])],32),s(L,{show:e.value,"onUpdate:show":m[1]||(m[1]=v=>e.value=v),overlay:!1,position:"top"},{default:d(()=>[s(z),s(G,{class:"proup-header",title:t.value.size===0?"请选择图书":`已经选择${t.value.size}本书`},null,8,["title"])]),_:1},8,["show"]),s(L,{show:e.value,"onUpdate:show":m[3]||(m[3]=v=>e.value=v),overlay:!1,position:"bottom"},{default:d(()=>[i("div",we,[s(B,{loading:l.value,block:"",icon:"delete",type:"danger",onClick:D},{default:d(()=>[y("删除 ")]),_:1},8,["loading"]),s(B,{loading:l.value,block:"",icon:"revoke",type:"default",onClick:m[2]||(m[2]=v=>e.value=!1)},{default:d(()=>[y("取消 ")]),_:1},8,["loading"])])]),_:1},8,["show"])],64)}}});export{He as default};
