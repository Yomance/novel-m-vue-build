var Gt=Object.defineProperty;var Xt=(e,t,s)=>t in e?Gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var h=(e,t,s)=>(Xt(e,typeof t!="symbol"?t+"":t,s),s);import{d as O,r as b,x as Y,e as _,D as ot,i as W,E as Tt,o as w,g as q,w as $,b as g,u,t as E,l as H,c as N,f as J,F as M,G as Q,n as xt,v as U,_ as V,p as tt,q as et,j as mt,A as vt,m as nt,H as pt,I as gt,B as Yt,z as Zt,h as Ht,J as Kt,s as Jt}from"./index-4fe7824b.js";import{s as Qt,S as At}from"./StatusBar-65dda7b0.js";import{c as te,m as ft,n as It,e as ee,v as se,b as ie,x as $t,y as Nt,p as ne,z as ae,A as oe,C as le,D as re,w as ce,u as yt,I as zt}from"./file-2a06de25.js";import{h as lt,n as at,s as Lt,a as he}from"./index-2f1714f2.js";import{g as de}from"./book-8bb6ced3.js";import{L as _t}from"./index-081089d8.js";import{u as ue,P as bt,B as wt,L as fe}from"./index-74f31b2d.js";import{C as pe}from"./index-a9a9e208.js";import{s as R,a as ge}from"./function-call-216768fc.js";import{a as xe}from"./bookshelf-97225b14.js";import{N as me}from"./index-6afe34d9.js";import{a as ve,T as ye}from"./index-a14b4af2.js";import{b as _e}from"./pay-7a4b9da0.js";import{l as be,p as Et,a as Ot}from"./comment-20ebaa7d.js";import{a as we}from"./user-51934867.js";const[ke,Z]=te("slider"),Se={min:ft(0),max:ft(100),step:ft(1),range:Boolean,reverse:Boolean,disabled:Boolean,readonly:Boolean,vertical:Boolean,barHeight:It,buttonSize:It,activeColor:String,inactiveColor:String,modelValue:{type:[Number,Array],default:0}};var Ce=O({name:ke,props:Se,emits:["change","dragEnd","dragStart","update:modelValue"],setup(e,{emit:t,slots:s}){let n,a,i;const o=b(),l=[b(),b()],r=b(),c=ue(),f=Y(()=>Number(e.max)-Number(e.min)),S=Y(()=>{const d=e.vertical?"width":"height";return{background:e.inactiveColor,[d]:ee(e.barHeight)}}),m=d=>e.range&&Array.isArray(d),y=()=>{const{modelValue:d,min:C}=e;return m(d)?`${(d[1]-d[0])*100/f.value}%`:`${(d-Number(C))*100/f.value}%`},x=()=>{const{modelValue:d,min:C}=e;return m(d)?`${(d[0]-Number(C))*100/f.value}%`:"0%"},v=Y(()=>{const C={[e.vertical?"height":"width"]:y(),background:e.activeColor};r.value&&(C.transition="none");const B=()=>e.vertical?e.reverse?"bottom":"top":e.reverse?"right":"left";return C[B()]=x(),C}),L=d=>{const C=+e.min,B=+e.max,A=+e.step;d=re(d,C,B);const F=Math.round((d-C)/A)*A;return oe(C,F)},T=()=>{const d=e.modelValue;m(d)?i=d.map(L):i=L(d)},p=d=>{var C,B;const A=(C=d[0])!=null?C:Number(e.min),F=(B=d[1])!=null?B:Number(e.max);return A>F?[F,A]:[A,F]},k=(d,C)=>{m(d)?d=p(d).map(L):d=L(d),$t(d,e.modelValue)||t("update:modelValue",d),C&&!$t(d,i)&&t("change",d)},j=d=>{if(d.stopPropagation(),e.disabled||e.readonly)return;T();const{min:C,reverse:B,vertical:A,modelValue:F}=e,D=Nt(o),Rt=()=>A?B?D.bottom-d.clientY:d.clientY-D.top:B?D.right-d.clientX:d.clientX-D.left,Ut=A?D.height:D.width,it=Number(C)+Rt()/Ut*f.value;if(m(F)){const[St,Ct]=F,Wt=(St+Ct)/2;it<=Wt?k([it,Ct],!0):k([St,it],!0)}else k(it,!0)},X=d=>{e.disabled||e.readonly||(c.start(d),a=e.modelValue,T(),r.value="start")},P=d=>{if(e.disabled||e.readonly)return;r.value==="start"&&t("dragStart",d),ne(d,!0),c.move(d),r.value="dragging";const C=Nt(o),B=e.vertical?c.deltaY.value:c.deltaX.value,A=e.vertical?C.height:C.width;let F=B/A*f.value;if(e.reverse&&(F=-F),m(i)){const D=e.reverse?1-n:n;a[D]=i[D]+F}else a=i+F;k(a)},dt=d=>{e.disabled||e.readonly||(r.value==="dragging"&&(k(a,!0),t("dragEnd",d)),r.value="")},Dt=d=>typeof d=="number"?Z("button-wrapper",["left","right"][d]):Z("button-wrapper",e.reverse?"left":"right"),Mt=(d,C)=>{const B=r.value==="dragging";if(typeof C=="number"){const A=s[C===0?"left-button":"right-button"];let F;if(B&&Array.isArray(a)&&(F=a[0]>a[1]?n^1:n),A)return A({value:d,dragging:B,dragIndex:F})}return s.button?s.button({value:d,dragging:B}):_("div",{class:Z("button"),style:le(e.buttonSize)},null)},ut=d=>{const C=typeof d=="number"?e.modelValue[d]:e.modelValue;return _("div",{ref:l[d??0],role:"slider",class:Dt(d),tabindex:e.disabled?void 0:0,"aria-valuemin":e.min,"aria-valuenow":C,"aria-valuemax":e.max,"aria-disabled":e.disabled||void 0,"aria-readonly":e.readonly||void 0,"aria-orientation":e.vertical?"vertical":"horizontal",onTouchstartPassive:B=>{typeof d=="number"&&(n=d),X(B)},onTouchend:dt,onTouchcancel:dt,onClick:ae},[Mt(C,d)])};return k(e.modelValue),se(()=>e.modelValue),l.forEach(d=>{ie("touchmove",P,{target:d})}),()=>_("div",{ref:o,style:S.value,class:Z({vertical:e.vertical,disabled:e.disabled}),onClick:j},[_("div",{class:Z("bar"),style:v.value},[e.range?[ut(0),ut(1)]:ut()])])}});const Te=ce(Ce),Ie=`url("${yt("/image/wallpapers/default.jpg")}")`;class z{constructor(){}}h(z,"NIGHT_COLOR","rgba(255,255,255,.5)"),h(z,"NIGHT_BACKGROUND","#1a1a1a"),h(z,"MIN_FONT_SIZE",12),h(z,"MAX_FONT_SIZE",48),h(z,"MAX_BRIGHTNESS",100),h(z,"MIN_BRIGHTNESS",1);const rt=ot({id:"ReadThemeStore",state:()=>({fontSize:18,fontFamily:"",lineHeight:1.4,letterSpacing:0,color:"#333",background:`url("${yt("/image/wallpapers/default.jpg")}")`,isNight:!1,brightness:100,brightnessAutoSystem:!1,segmentSpacing:1,statusBarColor:"white"}),getters:{styleObject:e=>({fontSize:e.fontSize+"px",fontFamily:e.fontFamily,lineHeight:e.lineHeight,letterSpacing:e.letterSpacing+"px",color:e.isNight?z.NIGHT_COLOR:e.color,background:e.isNight?z.NIGHT_BACKGROUND:e.background==="#edd19c"?Ie:e.background})},actions:{setFontSize(e){const t=this.fontSize+e;t<z.MIN_FONT_SIZE||t>z.MAX_FONT_SIZE||(this.fontSize=t)},setTheme(e){e.color&&(this.color=e.color),e.fontSize&&(this.fontSize=e.fontSize),e.fontFamily&&(this.fontFamily=e.fontFamily),e.background&&(this.background=e.background),e.lineHeight&&(this.lineHeight=e.lineHeight),e.letterSpacing&&(this.letterSpacing=e.letterSpacing)},setBrightness(e){this.brightness=e,Qt.brightness(e)},setBrightnessAutoSystem(){this.brightnessAutoSystem=!this.brightnessAutoSystem,console.error("暂不支持此功能")}},persist:{enabled:!0,strategies:[{storage:localStorage}]}}),$e=(e,t,s,n)=>lt.get("/chapter/dir",{params:{bookId:e,current:t,size:s,asc:n}}),Ne=e=>lt.get(`/chapter/buyList/${e}`),st=ot({id:"BookStore",state:()=>({loading:!1,bookId:"",book:{},chapterCount:0,buyList:new Set}),actions:{loadBookInfo(){return this.loading=!0,de(this.bookId).then(e=>{this.book=e,this.loadBuyList()}).catch(e=>console.error("err ",e)).finally(()=>this.loading=!1)},loadBuyList(){Ne(this.bookId).then(e=>e.forEach(t=>this.buyList.add(t)))}}}),qt=(e,t)=>lt.get("/chapter/read",{params:{bookId:e,chapterId:t}}),Pt=e=>lt.get("/chapter/ids",{params:{bookId:e}}),G=ot({id:"ChapterStore",state:()=>({chapterId:"",bookId:"",loading:!1,chapter:{id:"",name:"",isBuy:!1,free:!1}}),getters:{hasLast(){return this.chapter.lastId},hasNext(){return this.chapter.nextId}},actions:{loadChapter(){return this.bookId?(this.loading=!0,qt(this.bookId,this.chapterId).then(e=>(this.chapter=e,this.chapterId=e.id,e)).finally(()=>this.loading=!1)):Promise.reject("need bookId")},last(){if(this.hasLast){let e=this.chapterId;this.chapterId=this.chapter.lastId,this.loadChapter(),this.chapterId=e}},next(){if(this.hasNext){let e=this.chapterId;this.chapterId=this.chapter.nextId,this.loadChapter(),this.chapterId=e}}}}),Le={class:"book"},Pe=["src"],Be={class:"info"},Fe={class:"name van-ellipsis"},He={class:"author van-ellipsis"},Ae={class:"set"},ze={class:"count"},Ee=O({__name:"ChapterDir",props:{show:{type:Boolean,required:!0},position:{type:String,default:"left"},current:{type:String,default:1}},emits:["update:show"],setup(e,{emit:t}){const s=e,n=st(),a=G();function i(m){a.chapterId=m.id,a.loadChapter(),t("update:show",!1)}const o=b(!0);W(o,()=>{console.log(1),c=1,r.clear(),f.finished=!1});const l=Y(()=>s.position=="bottom"?{width:"100%",height:"80%"}:{width:"80%",height:"100%"}),r=Tt([]);let c=1;const f=Tt({loading:!1,finished:!1,error:!1});function S(){$e(n.bookId,c,20,o.value).then(m=>{r.push(...m.data),m.total<=r.length&&(f.finished=!0),c++}).catch(m=>f.error=!0).finally(()=>{xt(()=>f.loading=!1)})}return(m,y)=>{const x=zt,v=pe,L=_t,T=bt;return w(),q(T,{position:e.position,show:e.show,style:Q(l.value),class:"book-dir","onUpdate:show":y[3]||(y[3]=p=>t("update:show",p))},{default:$(()=>[_(At),g("div",Le,[g("img",{src:u(n).book.cover,alt:""},null,8,Pe),g("div",Be,[g("div",Fe,E(u(n).book.name),1),g("div",He,E(u(n).book.authorName),1)])]),g("div",Ae,[g("div",ze,"共"+E(u(n).book.chapterCount)+"章",1),g("div",{class:"sort",onClick:y[0]||(y[0]=p=>o.value=!o.value)},[_(x,{name:"exchange"}),H(" "+E(o.value?"倒":"正")+"序 ",1)])]),_(L,{error:u(f).error,"onUpdate:error":y[1]||(y[1]=p=>u(f).error=p),loading:u(f).loading,"onUpdate:loading":y[2]||(y[2]=p=>u(f).loading=p),finished:u(f).finished,class:"dir-list","finished-text":"没有更多了",onLoad:S},{default:$(()=>[(w(!0),N(M,null,J(u(r),p=>(w(),q(v,{class:U({lock:!(p.free||u(n).buyList.has(p.nums)),active:p.id===u(a).chapterId}),title:p.name,"title-class":"van-ellipsis title-class",onClick:k=>i(p)},{"right-icon":$(()=>[p.free||u(n).buyList.has(p.nums)?(w(),q(x,{key:0,size:18,name:"arrow"})):(w(),q(x,{key:1,size:18,"class-prefix":"iconfont icon",name:"lock"}))]),_:2},1032,["class","title","onClick"]))),256))]),_:1},8,["error","loading","finished"])]),_:1},8,["position","show","style"])}}});const Oe={class:"chapter-selector"},qe={class:"slider-container"},Ve=O({__name:"ChapterSelector",setup(e){const t=G(),s=st(),n=b(1),a=[],i=b(0);W(()=>t.chapter,()=>{a.indexOf(t.chapter.id)==-1?Pt(s.bookId).then(c=>{a.clearAndAddList(c),i.value=a.length,n.value=a.indexOf(t.chapter.id)+1}):n.value=a.indexOf(t.chapter.id)+1}),Pt(s.bookId).then(r=>{a.clearAndAddList(r),i.value=a.length});function o(r){t.chapterId=a[r-1],t.loadChapter()}function l(r=!0){if(!t.loading)if(r){if(!t.hasNext){R("已经是最新章节了");return}t.next()}else{if(!t.hasLast){R("已经是第一章了");return}t.last()}}return(r,c)=>{const f=Te;return w(),N("div",Oe,[g("span",{onClick:c[0]||(c[0]=S=>l(!1))},"上一章"),g("button",qe,[_(f,{modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=S=>n.value=S),max:i.value,min:1,onChange:o},null,8,["modelValue","max"])]),g("span",{onClick:l},"下一章")])}}});const je=V(Ve,[["__scopeId","data-v-73d0fec2"]]),ct=ot("readSetting",{state(){const e=b("tb"),t=b(),s=b();return{turnPageType:e,conf:t,novel:s}},persist:{enabled:!0,strategies:[{storage:localStorage}]}}),ht=e=>(tt("data-v-075251d6"),e=e(),et(),e),De={class:"setting-list"},Me={class:"item font"},Re=ht(()=>g("div",{class:"title"},"字号",-1)),Ue=ht(()=>g("div",{class:"space"},null,-1)),We={class:"item back"},Ge=ht(()=>g("div",{class:"title"},"背景",-1)),Xe={class:"con"},Ye=["onClick"],Ze={class:"item turn"},Ke=ht(()=>g("div",{class:"title"},"翻页",-1)),Je={class:"con"},Qe=O({__name:"SettingList",setup(e){const t=ct(),s=rt(),n=i=>{t.turnPageType=="emulation"&&(t.conf.color=i.color,t.conf.backgroundColor=i.background,t.novel.flush()),s.setTheme(i)},a=[{color:"#333",background:"#edd19c"},{color:"#333",background:"#cad9e8"},{color:"#333",background:"#d1edd1"},{color:"#333",background:"#e6e6e6"}];return(i,o)=>{const l=wt;return w(),N("div",De,[g("div",Me,[Re,_(l,{disabled:u(s).fontSize===u(z).MIN_FONT_SIZE,class:"set-size",round:"",size:"small",onClick:o[0]||(o[0]=r=>u(s).setFontSize(-2))},{default:$(()=>[H("A- ")]),_:1},8,["disabled"]),g("span",null,E(u(s).fontSize),1),_(l,{disabled:u(s).fontSize===u(z).MAX_FONT_SIZE,class:"set-size",round:"",size:"small",onClick:o[1]||(o[1]=r=>u(s).setFontSize(2))},{default:$(()=>[H("A+ ")]),_:1},8,["disabled"]),Ue,_(l,{disabled:"",icon:"arrow","icon-position":"right",round:"",size:"small"},{default:$(()=>[H("切换字体")]),_:1})]),g("div",We,[Ge,g("div",Xe,[(w(),N(M,null,J(a,r=>g("div",{class:U([{active:r.background===u(s).background&&r.color===u(s).color},"back-one"]),style:Q({background:r.background}),onClick:c=>n(r)},null,14,Ye)),64))])]),g("div",Ze,[Ke,g("div",Je,[_(l,{class:U(["turn-one",{active:u(t).turnPageType==="tb"}]),round:"",size:"small",onClick:o[2]||(o[2]=r=>u(t).turnPageType="tb")},{default:$(()=>[H("上下(手动)")]),_:1},8,["class"]),_(l,{class:U(["turn-one",{active:u(t).turnPageType==="emulation"}]),round:"",size:"small",onClick:o[3]||(o[3]=r=>u(t).turnPageType="emulation")},{default:$(()=>[H("仿真")]),_:1},8,["class"])])])])}}});const ts=V(Qe,[["__scopeId","data-v-075251d6"]]),es=O({__name:"alert",props:{show:{type:Boolean,required:!0}},emits:["update:show","chapter:update","showComment"],setup(e,{emit:t}){const s=e,n=ct(),a=G();b(!1);const i=rt(),o=mt(),l=vt();l.query.b,l.query.c;const r=x=>{t("update:show",x)};W(()=>s.show,x=>{!x&&m.value&&(m.value=!1)}),b(100),b(20);const c=st(),f=()=>{xe(c.bookId).then(x=>(c.book.inShelf=!0)&&R({message:"添加成功",position:"bottom"})).catch(x=>R({message:x,position:"bottom"}))};b(!1);const S=b(!1),m=b(!1);b(100);const y=b(!1);return W(y,(x,v,L)=>{alert("暂不支持此功能")}),(x,v)=>{const L=me,T=ve,p=ye;return w(),N("div",{class:"alert",onClick:v[7]||(v[7]=Yt(()=>{},["stop"]))},[g("div",{class:U([{hidden:!e.show},"header"])},[_(At,{color:e.show?"white":"black"},null,8,["color"]),_(L,{border:!1,"left-arrow":"",onClickLeft:v[2]||(v[2]=k=>u(o).back())},{right:$(()=>[u(c).book.inShelf?nt("",!0):(w(),N("span",{key:0,onClick:v[0]||(v[0]=k=>u(at)(f))},"加书架")),g("span",{onClick:v[1]||(v[1]=k=>t("showComment"))},"书评")]),_:1})],2),g("div",{class:U([{hidden:!e.show},"footer"])},[pt(_(ts,null,null,512),[[gt,m.value]]),u(n).turnPageType!=="emulation"?pt((w(),q(je,{key:0},null,512)),[[gt,!m.value]]):nt("",!0),_(p,{border:!1,fixed:!1},{default:$(()=>[_(T,{icon:"bars",onClick:v[3]||(v[3]=k=>(S.value=!0)&&r(!1))},{default:$(()=>[H("目录 ")]),_:1}),_(T,{icon:u(i).isNight?"rijianmoshixhdpi":"yejianmoshi","icon-prefix":"iconfont icon",onClick:v[4]||(v[4]=k=>u(i).isNight=!u(i).isNight)},{default:$(()=>[H(E(u(i).isNight?"日":"夜")+"间 ",1)]),_:1},8,["icon"]),_(T,{icon:m.value?"setting":"setting-o",onClick:v[5]||(v[5]=k=>m.value=!m.value)},{default:$(()=>[H("设置 ")]),_:1},8,["icon"])]),_:1})],2),_(Ee,{show:S.value,"onUpdate:show":v[6]||(v[6]=k=>S.value=k),current:u(a).chapter.id},null,8,["show","current"])])}}});const ss=V(es,[["__scopeId","data-v-1512d3fb"]]),is={class:"content"},ns=["data-id"],as={class:"btn-list"},os=O({__name:"content",emits:["click"],setup(e,{emit:t}){const s=G(),n=Y(()=>(s.chapter.content||"").split(`
`).map(i=>({id:i.substring(0,4),value:i.substring(5)})));return(a,i)=>{const o=fe,l=wt;return w(),N("div",is,[g("div",{class:"con",onClick:i[0]||(i[0]=r=>t("click"))},[u(s).loading?(w(),q(o,{key:1,class:"load",type:"spinner",color:"#1989fa"})):(w(!0),N(M,{key:0},J(n.value,r=>(w(),N("p",{"data-id":r.id},E(r.value),9,ns))),256))]),g("div",as,[_(l,{disabled:!u(s).hasLast||u(s).loading,size:"small",onClick:i[1]||(i[1]=r=>u(s).last())},{default:$(()=>[H("上一章")]),_:1},8,["disabled"]),_(l,{disabled:!u(s).hasNext||u(s).loading,size:"small",onClick:i[2]||(i[2]=r=>u(s).next())},{default:$(()=>[H("下一章")]),_:1},8,["disabled"])])])}}});const ls=V(os,[["__scopeId","data-v-8b3d0b1c"]]),rs=e=>(tt("data-v-d65ae74a"),e=e(),et(),e),cs={class:"buy"},hs={class:"btn gap-y-18"},ds={class:"ch"},us=rs(()=>g("span",null,null,-1)),fs=O({__name:"buy",setup(e){const t=G(),s=st();function n(){at(()=>{Lt({message:"购买本章即可阅读"}).then(()=>{const a=ge({message:"购买中...",forbidClick:!0,duration:0});_e(t.bookId,t.chapterId).then(i=>{a.message="获取章节内容...",t.loadChapter().then(o=>s.buyList.add(o.id)).finally(()=>a.close())}).catch(({message:i,code:o})=>{o===4100?Lt({message:i,confirmButtonText:"去充值"}).then(l=>Zt.push({name:"Pay"})):he({message:i}),a.close()})})})}return(a,i)=>{const o=wt;return w(),N("div",cs,[g("div",hs,[_(o,{onClick:n,type:"danger",round:"",block:""},{default:$(()=>[H("充值订阅本章："+E(u(t).chapter.price)+"金币",1)]),_:1}),g("div",ds,[_(o,{type:"primary",style:{"margin-top":"16px"},round:"",disabled:!u(t).hasLast,onClick:i[0]||(i[0]=l=>u(t).last())},{default:$(()=>[H("上一章 ")]),_:1},8,["disabled"]),us,_(o,{type:"primary",style:{"margin-top":"16px"},round:"",disabled:!u(t).hasNext,onClick:i[1]||(i[1]=l=>u(t).next())},{default:$(()=>[H("下一章 ")]),_:1},8,["disabled"])])])])}}});const ps=V(fs,[["__scopeId","data-v-d65ae74a"]]),gs={class:"comment"},xs={class:"avatar"},ms=["src"],vs={class:"content"},ys={class:"head"},_s={class:"body"},bs={key:0},ws={class:"footer"},ks={class:"size"},Ss=O({__name:"comment",props:{data:{type:Object,required:!0},isRoot:{type:Boolean,default:!1},showReplyUser:{type:Boolean,default:!1}},emits:["comment","list"],setup(e,{emit:t}){const s=e,n=()=>{be(s.data.id,!s.data.isLike),s.data.likeNum=parseInt(s.data.likeNum)+(s.data.isLike?-1:1),s.data.isLike=!s.data.isLike};return(a,i)=>{var l,r,c;const o=zt;return w(),N("div",gs,[g("div",xs,[g("img",{src:e.data.user.avatar,alt:""},null,8,ms)]),g("div",vs,[g("div",ys,E(e.data.user.username),1),g("div",_s,[e.showReplyUser&&((l=e.data)!=null&&l.replyUser)?(w(),N("span",bs,"@"+E((c=(r=e.data)==null?void 0:r.replyUser)==null?void 0:c.username)+": ",1)):nt("",!0),H(" "+E(e.data.content),1)]),g("div",ws,[g("span",{class:"like",onClick:n},[e.data.isLike?(w(),q(o,{key:0,color:"#fb7299",name:"good-job"})):(w(),q(o,{key:1,name:"good-job-o"})),g("span",ks,E(e.data.likeNum),1)]),_(o,{name:"chat-o",onClick:i[0]||(i[0]=f=>t("comment",e.data))})]),e.isRoot&&e.data.childrenNum>0?(w(),N("div",{key:0,class:"replay-box",onClick:i[1]||(i[1]=f=>t("list",e.data))},[H("共"+E(e.data.childrenNum)+"条回复 ",1),_(o,{name:"arrow"})])):nt("",!0)])])}}});const Vt=V(Ss,[["__scopeId","data-v-86e20985"]]),Cs={class:"text"},Ts=["value"],Is=O({__name:"textarea",props:{text:{type:String},focus:{type:Boolean,default:!1}},emits:["send","blur","update:text","update:focus"],setup(e,{emit:t}){const s=e,n=b();let a=!1;function i(r){var c;console.log(r),a=document.activeElement!==n.value&&document.activeElement!==((c=n.value)==null?void 0:c.parentElement)}function o(){s.text!=""&&(t("send"),a&&(t("blur"),t("update:focus",!1),a=!0))}const l=b();return W(()=>s.focus,r=>{r&&l.value&&l.value.focus()}),(r,c)=>(w(),N("div",Cs,[g("textarea",{ref_key:"textarea",ref:l,value:e.text,class:"textarea",onFocus:c[0]||(c[0]=(...f)=>u(at)&&u(at)(...f)),rows:"1",onBlur:i,onInput:c[1]||(c[1]=f=>t("update:text",f.target.value))},null,40,Ts),g("div",{ref_key:"buttonRef",ref:n,class:U([{disable:e.text===""},"publish"]),onClick:o},"发送",2)]))}});const jt=V(Is,[["__scopeId","data-v-bdcb9780"]]),$s=e=>(tt("data-v-223549ec"),e=e(),et(),e),Ns={class:"content"},Ls=$s(()=>g("div",{class:"van-hairline--bottom",style:{"margin-bottom":"16px"}},null,-1)),Ps=O({__name:"children-panel",props:{show:{type:Boolean,default:!1},parent:{type:Object}},emits:["update:show"],setup(e,{emit:t}){const s=e,n=Ht([]),a=b(!1),i=b(!1),o=b(1),l=()=>{n.splice(0,n.length),o.value=1,i.value=!1},r=()=>{var x,v,L;Et(o.value,(x=s.parent)==null?void 0:x.chapterId,{segmentId:(v=s.parent)==null?void 0:v.sid,replyId:(L=s.parent)==null?void 0:L.id}).then(T=>{o.value=T.current+1,T.data||(i.value=!0),n.push(...T.data),i.value=n.length>=T.total}).catch(T=>console.error("err: ",T)).finally(()=>xt(()=>a.value=!1))},c=b(""),f=b(),S=b(!1);function m(x){c.value="",f.value=x,S.value=!0}const y=()=>{var v,L,T,p,k;let x=(v=f.value)==null?void 0:v.userId;Ot((L=s.parent)==null?void 0:L.bookId,(T=s.parent)==null?void 0:T.chapterId,c.value,(p=s.parent)==null?void 0:p.segmentId,(k=s.parent)==null?void 0:k.id,x).then(j=>{R("发布成功"),o.value=1,i.value=!1,c.value="",n.splice(0,n.length),a.value=!0,r(),f.value=null}).catch(({message:j})=>R(j))};return(x,v)=>{const L=_t,T=bt;return w(),q(T,{style:Q([{padding:"16px 0 54px 0"},{height:"90%"}]),round:"",show:e.show,"onUpdate:show":v[4]||(v[4]=p=>t("update:show",p)),position:"bottom",onOpen:l},{default:$(()=>[g("div",Ns,[_(L,{loading:a.value,"onUpdate:loading":v[0]||(v[0]=p=>a.value=p),finished:i.value,"finished-text":"没有更多了",onLoad:r},{default:$(()=>[(w(!0),N(M,null,J(n,p=>(w(),N(M,null,[_(Vt,{data:p,style:{"padding-bottom":"16px"},onComment:m,"show-reply-user":""},null,8,["data"]),Ls],64))),256))]),_:1},8,["loading","finished"])]),_(jt,{focus:S.value,"onUpdate:focus":v[1]||(v[1]=p=>S.value=p),text:c.value,"onUpdate:text":v[2]||(v[2]=p=>c.value=p),onBlur:v[3]||(v[3]=p=>f.value=null),onSend:y},null,8,["focus","text"])]),_:1},8,["show"])}}});const Bs=V(Ps,[["__scopeId","data-v-223549ec"]]),kt=e=>(tt("data-v-a99ee9c2"),e=e(),et(),e),Fs={class:"content"},Hs={key:0,class:"empty"},As=["src"],zs=kt(()=>g("div",null,"暂无评论",-1)),Es=kt(()=>g("p",null,"快来评论一下吧！",-1)),Os=kt(()=>g("div",{class:"van-hairline--bottom",style:{"margin-bottom":"16px"}},null,-1)),qs=O({__name:"index",props:{show:{type:Boolean,default:!1},bid:{type:String,required:!0},cid:{type:String,required:!0},sid:{type:String,required:!1},text:{type:String,required:!1}},emits:["update:show"],setup(e,{emit:t}){const s=e,n=Ht([]),a=b(!1),i=b(!1),o=b(1),l=()=>{r.value=!1,n.splice(0,n.length),o.value=1,i.value=!1,a.value=!0,c()},r=b(!1),c=()=>{Et(o.value,s.cid,{segmentId:s.sid}).then(p=>{if(o.value=p.current+1,!p.data){r.value=!0,i.value=!0;return}n.push(...p.data),i.value=n.length>=p.total,r.value=!1}).catch(p=>console.error("err: ",p)).finally(()=>xt(()=>a.value=!1))},f=b(!1),S=p=>{m.value=p,f.value=!0},m=b(),y=b(""),x=b(!1);function v(p){x.value=!1,y.value="",m.value=p,setTimeout(()=>x.value=!0)}const L=()=>{var j,X;let p=(j=m.value)==null?void 0:j.id,k=(X=m.value)==null?void 0:X.userId;Ot(s.bid,s.cid,y.value,s.sid,p,k).then(P=>{R("发布成功"),o.value=1,i.value=!1,y.value="",n.splice(0,n.length),a.value=!0,c(),m.value=null}).catch(({message:P})=>R(P))},T=mt();return T.onBack=()=>f.value?(f.value=!1,!1):s.show?(t("update:show",!1),!1):(T.onBack=()=>!0,!0),(p,k)=>{const j=_t,X=bt;return w(),q(X,{show:e.show,style:Q([{height:"95%"},{padding:"16px 0 54px 0"}]),position:"bottom",round:"",onOpen:l,"onUpdate:show":k[5]||(k[5]=P=>t("update:show",P))},{default:$(()=>[g("div",Fs,[r.value?(w(),N("div",Hs,[g("img",{style:{"max-width":"100%"},src:u(yt)("/image/no-comment-1.png"),alt:"暂无评论"},null,8,As),zs,Es])):(w(),q(j,{key:1,finished:i.value,loading:a.value,"finished-text":"没有更多了",onLoad:c,"onUpdate:loading":k[0]||(k[0]=P=>a.value=P)},{default:$(()=>[(w(!0),N(M,null,J(n,P=>(w(),N(M,null,[_(Vt,{data:P,"is-root":"",style:{"padding-bottom":"16px"},onComment:v,onList:dt=>S(P)},null,8,["data","onList"]),Os],64))),256))]),_:1},8,["finished","loading"]))]),_(Bs,{show:f.value,"onUpdate:show":k[1]||(k[1]=P=>f.value=P),parent:m.value},null,8,["show","parent"]),_(jt,{focus:x.value,"onUpdate:focus":k[2]||(k[2]=P=>x.value=P),text:y.value,"onUpdate:text":k[3]||(k[3]=P=>y.value=P),onBlur:k[4]||(k[4]=P=>m.value=null),onSend:L},null,8,["focus","text"])]),_:1},8,["show"])}}});const Vs=V(qs,[["__scopeId","data-v-a99ee9c2"]]),js={lineHeight:26,fontSize:16,fontFamily:"sans-serif",padding:16,backgroundColor:"#edd19c",color:"#000",turnPageStep:16,cancelTurnPageStep:8,shadowStart:"rgba(0,0,0,0.5)",shadowEnd:"rgba(0,0,0,0)",cancelTurnPageFlag:.33,headerHeight:30,footerHeight:30},Ds=e=>{let t={lineHeight:26,fontSize:16,fontFamily:"sans-serif",padding:16,backgroundColor:"#edd19c",color:"#000",turnPageStep:16,cancelTurnPageStep:8,shadowStart:"rgba(0,0,0,0.5)",shadowEnd:"rgba(0,0,0,0)",cancelTurnPageFlag:.33,headerHeight:30,footerHeight:30};return Object.assign(t,e),t};class Ms{constructor(t,s,n,a,i=js){h(this,"ctx");h(this,"devicePixelRatio");h(this,"pageWidth");h(this,"pageHeight");h(this,"lineHeight");h(this,"fontSize");h(this,"fontFamily");h(this,"padding");h(this,"backgroundColor");h(this,"color");h(this,"turnPageStep");h(this,"cancelTurnPageStep");h(this,"shadowStart");h(this,"shadowEnd");h(this,"font");h(this,"cancelTurnPageSize");h(this,"headerHeight");h(this,"footerHeight");h(this,"pageLines");this.ctx=a,this.devicePixelRatio=t,this.pageWidth=s*t,this.pageHeight=n*t,this.fontSize=i.fontSize*t,this.fontFamily=i.fontFamily,this.padding=i.padding*t,this.backgroundColor=i.backgroundColor,this.color=i.color,this.turnPageStep=i.turnPageStep*t,this.cancelTurnPageStep=i.cancelTurnPageStep*t,this.shadowStart=i.shadowStart,this.shadowEnd=i.shadowEnd,this.font=this.fontSize+"px "+this.fontFamily,this.cancelTurnPageSize=this.pageWidth*i.cancelTurnPageFlag,this.headerHeight=i.headerHeight*t,this.footerHeight=i.footerHeight*t,this.lineHeight=i.lineHeight*t;const o=this.pageHeight-(this.padding+this.padding+this.headerHeight+this.footerHeight);this.pageLines=Math.floor(o/this.lineHeight),this.lineHeight=o/this.pageLines}}class I{constructor(t,s){h(this,"y");h(this,"x");this.x=t,this.y=s}static of(t,s){return new I(t,s)}static copyOf(t){return this.of(t.x,t.y)}copyOf(t){this.x=t.x,this.y=t.y}}const Bt=(e,t,s,n,a)=>{for(let i=0;i<.5;i+=.01){let o=i*i,l=2*i,r=1+o-l,c=l-2*o,f=r*e.x+c*t.x+o*s.x,S=r*e.y+c*t.y+o*s.y;n(f,S)}for(let i=.5;i<=1;i+=.01){let o=i*i,l=2*i,r=1+o-l,c=l-2*o,f=r*e.x+c*t.x+o*s.x,S=r*e.y+c*t.y+o*s.y;a(f,S)}};class Rs{constructor(t,s){h(this,"a");h(this,"b",I.of(0,0));h(this,"c",I.of(0,0));h(this,"d",I.of(0,0));h(this,"e",I.of(0,0));h(this,"f");h(this,"g",I.of(0,0));h(this,"h",I.of(0,0));h(this,"i",I.of(0,0));h(this,"j",I.of(0,0));h(this,"k",I.of(0,0));h(this,"fun",t=>{});this.f=I.of(t,s),this.a=I.of(t,s)}move(t,s=!0){this.a.copyOf(t),this.calc(),s&&this.calcPointCX()<0&&(this.calcPointAByTouchPoint(),this.calc())}calc(){this.g.x=(this.a.x+this.f.x)/2,this.g.y=(this.a.y+this.f.y)/2,this.e.x=this.g.x-(this.f.y-this.g.y)*(this.f.y-this.g.y)/(this.f.x-this.g.x),this.e.y=this.f.y,this.h.x=this.f.x,this.h.y=this.g.y-(this.f.x-this.g.x)*(this.f.x-this.g.x)/(this.f.y-this.g.y),this.c.x=this.e.x-(this.f.x-this.e.x)/2,this.c.y=this.f.y,this.j.x=this.f.x,this.j.y=this.h.y-(this.f.y-this.h.y)/2,this.b.copyOf(Ft(this.a,this.e,this.c,this.j)),this.k.copyOf(Ft(this.a,this.h,this.c,this.j)),this.d.x=(this.c.x+2*this.e.x+this.b.x)/4,this.d.y=(2*this.e.y+this.c.y+this.b.y)/4,this.i.x=(this.j.x+2*this.h.x+this.k.x)/4,this.i.y=(2*this.h.y+this.j.y+this.k.y)/4}calcPointAByTouchPoint(){let t=this.f.x,s=t-this.c.x,n=Math.abs(this.f.x-this.a.x),a=t*n/s;this.a.x=Math.abs(this.f.x-a);let i=Math.abs(this.f.y-this.a.y),o=a*i/n;this.a.y=Math.abs(this.f.y-o)}calcPointCX(){let t=I.copyOf(this.a),s=I.copyOf(this.f),n=I.of(0,0),a=I.of(0,0);return n.x=(t.x+s.x)/2,n.y=(t.y+s.y)/2,a.x=n.x-(s.y-n.y)*(s.y-n.y)/(s.x-n.x),a.y=s.y,a.x-(s.x-a.x)/2}}function Ft(e,t,s,n){let a=e.x,i=e.y,o=t.x,l=t.y,r=s.x,c=s.y,f=n.x,S=n.y,m=((a-o)*(r*S-f*c)-(r-f)*(a*l-o*i))/((r-f)*(i-l)-(a-o)*(c-S)),y=((i-l)*(r*S-f*c)-(a*l-o*i)*(c-S))/((i-l)*(r-f)-(a-o)*(c-S));return I.of(m,y)}class Us{constructor(t){h(this,"conf");h(this,"pc");h(this,"ctx");h(this,"onclick");h(this,"W");h(this,"H");h(this,"isSlideSideways",!1);h(this,"isAnimation",!1);h(this,"turnType","next");h(this,"isClick",!1);this.conf=t,this.ctx=t.ctx,this.W=t.pageWidth,this.H=t.pageHeight,this.pc=new Rs(this.W,this.H),this.ctx.canvas.ontouchstart=this.touchStart.bind(this)}getEventPoint(t){let s=t.changedTouches[0];return I.of(s.clientX*this.conf.devicePixelRatio,s.clientY*this.conf.devicePixelRatio)}touchStart(t){if(this.isAnimation)return;this.isClick=!0;let{x:s,y:n}=this.getEventPoint(t);s<this.W/3?(this.hasLast()&&(this.ctx.canvas.ontouchmove=this.touchMove.bind(this),this.ctx.canvas.ontouchend=this.touchEnd.bind(this)),this.turnType="last"):(this.hasNext()&&(this.ctx.canvas.ontouchmove=this.touchMove.bind(this),this.ctx.canvas.ontouchend=this.touchEnd.bind(this)),this.turnType="next"),n<this.H*.66666&&(this.isSlideSideways=!0)}touchMove(t){if(this.isAnimation)return;this.isClick=!1;let{x:s,y:n}=this.getEventPoint(t);this.isSlideSideways?this.pc.move(I.of(s,this.H-1e-4)):this.pc.move(I.of(s,n)),this.onDraw()}touchEnd(t){if(this.isAnimation)return;if(this.isClick){this.onclick&&this.onclick();return}let{x:s}=this.getEventPoint(t);this.turnType==="next"?(s>=this.W-this.conf.cancelTurnPageSize?this.cancelTurnPageNext():this.turnPageNext(),this.isSlideSideways=!1):this.turnType==="last"?(s>this.W/3?this.cancelTurnPageNext():this.turnPageNext(),this.isSlideSideways=!1):console.log(this.turnType),this.ctx.canvas.ontouchmove=void 0,this.ctx.canvas.ontouchend=void 0}cancelTurnPageNext(){this.isAnimation=!0;let t=this.pc.f.x,s=this.pc.f.y,n=this.conf.cancelTurnPageStep;const a=t-this.pc.a.x;let o=(s-this.pc.a.y)/(a/n);const l=I.of(this.pc.a.x,this.pc.a.y),r=()=>{if(l.x+=n,l.y+=o,this.pc.move(l),this.onDraw(),l.x>t||l.y>s){this.isAnimation=!1,this.turnType=="last"&&this.last();return}requestAnimationFrame(r)};requestAnimationFrame(r)}turnPageNext(){this.isAnimation=!0;let t=this.pc.f.x,s=this.pc.f.y,n=this.conf.turnPageStep;const a=t+this.pc.a.x;let o=(s-this.pc.a.y)/(a/n);const l=I.of(this.pc.a.x,this.pc.a.y),r=()=>{if(l.x-=n,l.y+=o,this.pc.move(l,!1),this.onDraw(),l.x>t||l.y>s){this.drawC(),this.turnType==="next"&&this.next(),this.isAnimation=!1;return}requestAnimationFrame(r)};requestAnimationFrame(r)}calcPath(){const t=new Path2D;t.moveTo(0,0),t.lineTo(0,this.pc.f.y);const s=new Path2D;s.moveTo(this.pc.d.x,this.pc.d.y);const n=new Path2D;n.moveTo(this.pc.f.x,this.pc.f.y);const a=new Path2D;a.moveTo(0,0),a.lineTo(0,this.pc.f.y);const i=new Path2D;return i.moveTo(this.pc.f.x,this.pc.f.y),Bt(this.pc.c,this.pc.e,this.pc.b,(o,l)=>{t.lineTo(o,l),n.lineTo(o,l),a.lineTo(o,l),i.lineTo(o,l)},(o,l)=>{t.lineTo(o,l),s.lineTo(o,l),i.lineTo(o,l)}),t.lineTo(this.pc.a.x,this.pc.a.y),t.lineTo(this.pc.k.x,this.pc.k.y),s.lineTo(this.pc.a.x,this.pc.a.y),s.lineTo(this.pc.k.x,this.pc.k.y),n.lineTo(this.pc.i.x,this.pc.i.y),a.lineTo(this.pc.i.x,this.pc.i.y),i.lineTo(this.pc.a.x,this.pc.a.y),i.lineTo(this.pc.k.x,this.pc.k.y),Bt(this.pc.k,this.pc.h,this.pc.j,(o,l)=>{t.lineTo(o,l),s.lineTo(o,l),i.lineTo(o,l)},(o,l)=>{t.lineTo(o,l),n.lineTo(o,l),a.lineTo(o,l),i.lineTo(o,l)}),t.lineTo(this.pc.f.x,0),t.closePath(),s.closePath(),n.closePath(),a.lineTo(this.pc.f.x,0),a.closePath(),{qa:t,qb:s,qc:n,qab:a,qbc:i}}onDraw(){this.ctx.clearRect(0,0,this.pc.f.x,this.pc.f.y),this.ctx.save(),this.draw(),this.ctx.restore()}draw(){let{qa:t,qb:s,qc:n,qbc:a}=this.calcPath();this.ctx.save(),this.ctx.clip(t),this.drawA(),this.ctx.shadowBlur=20,this.ctx.shadowOffsetX=-5,this.ctx.shadowOffsetY=-5,this.ctx.shadowColor=this.conf.shadowStart,this.ctx.fill(a),this.ctx.restore(),this.ctx.save(),this.ctx.clip(s),this.drawB(),this.drawShadowB(),this.ctx.restore(),this.ctx.save(),this.ctx.clip(n),this.drawC(),this.drawShadowC(),this.ctx.restore()}drawShadowB(){this.drawShadowB_C(!0)}drawShadowC(){this.drawShadowB_C(!1)}drawShadowB_C(t){let s=(this.pc.f.x-this.pc.c.x)/4,n=Math.hypot(this.pc.f.x,this.pc.f.y)+this.pc.f.y;this.ctx.translate(this.pc.c.x,this.pc.c.y);const a=Math.atan2(this.pc.e.x-this.pc.f.x,this.pc.h.y-this.pc.f.y);this.ctx.rotate(a);const i=this.ctx.createLinearGradient(-s,0,0,0);i.addColorStop(t?0:1,this.conf.shadowStart),i.addColorStop(t?1:0,this.conf.shadowEnd),this.ctx.fillStyle=i,this.ctx.fillRect(-s,0,s,n)}drawPoint(){this.ctx.strokeText("a",this.pc.a.x,this.pc.a.y),this.ctx.strokeText("b",this.pc.b.x,this.pc.b.y),this.ctx.strokeText("c",this.pc.c.x,this.pc.c.y),this.ctx.strokeText("d",this.pc.d.x,this.pc.d.y),this.ctx.strokeText("e",this.pc.e.x,this.pc.e.y),this.ctx.strokeText("f",this.pc.f.x,this.pc.f.y),this.ctx.strokeText("g",this.pc.g.x,this.pc.g.y),this.ctx.strokeText("h",this.pc.h.x,this.pc.h.y),this.ctx.strokeText("i",this.pc.i.x,this.pc.i.y),this.ctx.strokeText("j",this.pc.j.x,this.pc.j.y),this.ctx.strokeText("k",this.pc.k.x,this.pc.k.y)}drawLoading(){const t=this.ctx.measureText("加载中……").width/2;this.ctx.fillText("加载中……",this.W/2-t,this.H/2-t)}drawFinish(){const t=this.ctx.measureText("暂无更多章节").width/2;this.ctx.fillText("暂无更多章节",this.W/2-t,this.H/2-t)}flush(){this.turnType==="next"?this.drawA():this.drawC()}}const Ws=(e,t,s)=>{const{width:n}=e.measureText("一"),a=Math.floor(s/n),i=[];return t.forEach(({val:o})=>{o="　　"+o;let l=0;for(;;){let r=l+a;for(;;){let c=o.substring(l,r),f=e.measureText(c).width;if(Math.abs(f-s)<=n){l=r,c&&i.push(c);break}if(f<s&&++r>o.length){c&&i.push(c);break}}if(r>=o.length)break}}),i};class K{constructor(t,s){h(this,"list");h(this,"name");h(this,"id");h(this,"index",0);this.id=t.id,this.name=t.name;const n=this.parseContent(t.content),a=Ws(s.ctx,n,s.pageWidth-s.padding*2);this.list=this.toPages(a,s.pageLines)}static of(t,s){return new K(t,s)}isFirst(){return this.index==0}first(){this.index=0}final(){this.index=this.list.length-1}next(){return this.index>=this.list.length-1?null:++this.index}getNext(){return this.index>=this.list.length-1?null:{name:this.name,id:this.id,list:this.list[this.index+1]}}last(){return this.index<=0?null:--this.index}getLast(){return this.index<=0?null:{name:this.name,id:this.id,list:this.list[this.index-1]}}getCurrent(){return{name:this.name,id:this.id,list:this.list[this.index]}}parseContent(t){return t.split(`
`).map(s=>({id:s.substring(0,4),val:s.substring(5)}))}toPages(t,s){let n=[],a=[];for(let i=0,o=0;i<t.length;i++,o++)o>=s&&(o=0,n.push(a),a=[]),a.push(t[i]);return a.length>0&&n.push(a),n}}class Gs{constructor(t,s,n,a,i){h(this,"chapters",[]);h(this,"index",0);h(this,"conf");h(this,"loadNext",()=>Promise.reject());h(this,"loadLast",()=>Promise.reject());h(this,"flush",()=>{});h(this,"ctx");h(this,"loadingNext",!1);h(this,"loadingLast",!1);h(this,"isLoadFinal",!1);h(this,"isLoadFirst",!1);this.flush=i,this.loadNext=s,this.loadLast=n,this.ctx=a.ctx,this.conf=a,this.chapters.push(K.of(t,a)),this.isLoadFirst=t.isFirst,this.isLoadFinal=t.isFinal}getCurrent(){return this.index>=this.chapters.length?this.isLoadFinal?"loading":"finish":this.index<0?this.isLoadFirst?"loading":"finish":this.chapters[this.index].getCurrent()}getLast(){let t=this.chapters[this.index];if(t==null)return t=this.chapters[this.index-1],t.getCurrent();const s=t.getLast();return s??(this.index===0?this.isLoadFirst?"finish":(this.loadingLast||(this.loadingLast=!0,this.loadLast().then(n=>{const a=K.of(n,this.conf);a.final(),this.chapters.unshift(a),this.index++,this.isLoadFirst=n.isFirst}).finally(()=>{this.loadingLast=!1,this.flush()})),"loading"):this.chapters[this.index-1].getCurrent())}getNext(){let t=this.chapters[this.index];t==null&&(t=this.chapters[this.index+1]);const s=t.getNext();return s??(this.index===this.chapters.length-1?this.isLoadFinal?"finish":(this.loadingNext||(this.loadingNext=!0,this.loadNext().then(n=>{const a=K.of(n,this.conf);a.first(),this.chapters.push(a),this.isLoadFinal=n.isFinal}).finally(()=>{this.loadingNext=!1,this.flush()})),"loading"):this.chapters[this.index+1].getCurrent())}next(){if(this.index==-1){this.index++;const s=this.chapters[this.index];s&&s.first();return}if(this.chapters[this.index].next()===null){this.index++;const s=this.chapters[this.index];s&&s.first()}}last(){if(this.index==this.chapters.length){this.index--;const s=this.chapters[this.index];s&&s.final();return}if(this.chapters[this.index].last()===null){this.index--;const s=this.chapters[this.index];s&&s.final()}}hasLast(){return this.index==0&&this.chapters[this.index].isFirst()&&this.isLoadFirst?!1:this.index>=0}hasNext(){return this.index!==this.chapters.length}}class Xs extends Us{constructor(s,n,a,i){super(s);h(this,"paddingLR");h(this,"dc");this.paddingLR=s.padding,this.ctx.font=s.font,this.dc=new Gs(n,a,i,s,this.flush.bind(this)),this.drawA()}drawA(){this.extracted();const s=this.turnType==="next"?this.dc.getCurrent():this.dc.getLast();typeof s=="string"?s==="loading"?this.drawLoading():this.drawFinish():(this.drawTitle(s.name),this.drawPage(s.list))}drawTitle(s){this.ctx.fillText(s,this.conf.padding,this.conf.padding+this.conf.headerHeight/2)}drawB(){this.ctx.fillStyle=this.conf.backgroundColor,this.ctx.fillRect(0,0,this.W,this.H)}drawC(){this.extracted();const s=this.turnType==="next"?this.dc.getNext():this.dc.getCurrent();typeof s=="string"?s==="loading"?this.drawLoading():this.drawFinish():(this.drawTitle(s.name),this.drawPage(s.list))}extracted(){this.ctx.fillStyle=this.conf.backgroundColor,this.ctx.fillRect(0,0,this.W,this.H),this.ctx.fillStyle=this.conf.color,this.ctx.textBaseline="middle"}last(){this.dc.last()}next(){this.dc.next()}hasLast(){return this.dc.hasLast()}hasNext(){return this.dc.hasNext()}drawPage(s){let n=this.conf.padding,a=this.conf.padding+this.conf.headerHeight;a+=this.conf.lineHeight/2;for(let i of s)this.ctx.fillText(i,n,a),a+=this.conf.lineHeight}}const Ys={width:"375",height:"667"},Zs=O({__name:"emulation",emits:["click"],setup(e,{emit:t}){const s=ct(),n=rt(),a=vt(),i=G();let o=a.query.bid,l=i.chapterId||a.query.cid||"";const r=b(),c=async y=>{const x=await qt(o,y);return r.value=x,{id:x.id,name:x.name,content:x.content,isFirst:!x.lastId,isFinal:!x.nextId}},f=()=>c(r.value.nextId),S=()=>c(r.value.lastId);let m;return Kt(()=>{c(l).then(y=>{const x=document.getElementsByTagName("canvas")[0];let v=x.offsetWidth,L=x.offsetHeight;const T=x.getContext("2d"),p=new Ms(devicePixelRatio|2,v,L,T,Ds({color:n.color,backgroundColor:n.background.includes("u")?"#edd19c":n.background,fontSize:n.fontSize}));s.conf=p,x.width=p.pageWidth,x.height=p.pageHeight,m=new Xs(p,y,f,S),s.novel=m,m.onclick=function(){t("click")},W(()=>n.isNight,()=>{n.isNight?(p.color=z.NIGHT_COLOR,p.backgroundColor=z.NIGHT_BACKGROUND):(p.color=n.color,p.backgroundColor=n.background),m.flush()})})}),(y,x)=>(w(),N("canvas",Ys))}});const Ks=e=>(tt("data-v-fb1086db"),e=e(),et(),e),Js={class:"header"},Qs=Ks(()=>g("div",{class:"footer"},null,-1)),ti=O({__name:"index",setup(e){Jt(m=>({"0dbf8d2c":u(o).segmentSpacing+"em"}));const t=ct(),s=Y(()=>{var m;return c.loading||c.chapter.free||((m=c.chapter)==null?void 0:m.isBuy)});setTimeout(we,60500);const n=b(!1),a=mt(),i=st(),o=rt(),l=b(!1);let r=vt();const c=G();let f=r.query.bid,S=r.query.cid||"";return f||a.push({name:"404"}),c.bookId=f,c.chapterId=S||"",W(()=>c.chapter,m=>{!m.free&&!m.isBuy&&(l.value=!1)}),i.bookId=f,i.loadBookInfo().then(m=>{c.chapterId||(c.chapterId=i.book.readTo),c.loadChapter()}),(m,y)=>(w(),N(M,null,[u(t).turnPageType==="emulation"?(w(),q(Zs,{key:0,onClick:y[0]||(y[0]=x=>l.value=!l.value)})):(w(),N("div",{key:1,style:Q(u(o).styleObject),class:"read-view"},[g("div",Js,E(u(c).chapter.name),1),_(ls,{onClick:y[1]||(y[1]=x=>l.value=!l.value)}),Qs],4)),_(ss,{show:l.value,"onUpdate:show":y[2]||(y[2]=x=>l.value=x),onShowComment:y[3]||(y[3]=x=>l.value=!(n.value=!0))},null,8,["show"]),pt(_(ps,null,null,512),[[gt,!s.value]]),_(Vs,{show:n.value,"onUpdate:show":y[4]||(y[4]=x=>n.value=x),bid:u(f)||"",cid:u(c).chapterId,text:u(c).chapter.name||""},null,8,["show","bid","cid","text"])],64))}});const mi=V(ti,[["__scopeId","data-v-fb1086db"]]);export{mi as default};
