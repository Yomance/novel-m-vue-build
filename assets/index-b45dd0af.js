import{d as L,r as C,x as V,P as pe,e as u,i as j,y as he,n as X,j as ge,h as be,o as we,c as Ce,w as M,l as Z,t as ye,b as xe,_ as Te}from"./index-b21a5062.js";import{C as _e,s as Oe,r as ke,F as Se}from"./slider-b6bcd0b2.js";import{u as Ve}from"./index-9167eec7.js";import{c as K,M as Pe,f as D,D as Q,n as q,L as U,o as A,h as se,b as ie,p as ue,H as ee,m as F,t as Ee,s as Ie,d as Me,_ as De,x as G,q as te,$ as He,w as Ne}from"./file-5968fc18.js";import{u as Be,d as re,L as $e,B as Ue,P as Fe}from"./index-1ab0a0de.js";import{a as Re,s as z}from"./function-call-eb60fd77.js";import{F as Ae}from"./index-21612e1f.js";import{C as Le}from"./index-9b70e7c1.js";import"./index-7cf97704.js";import"./use-id-c0295969.js";const[Ke,O,ne]=K("picker"),ce=e=>e.find(a=>!a.disabled)||e[0];function Ye(e,a){const l=e[0];if(l){if(Array.isArray(l))return"multiple";if(a.children in l)return"cascade"}return"default"}function R(e,a){a=Q(a,0,e.length);for(let l=a;l<e.length;l++)if(!e[l].disabled)return l;for(let l=a-1;l>=0;l--)if(!e[l].disabled)return l;return 0}const oe=(e,a,l)=>a!==void 0&&!!e.find(r=>r[l.value]===a);function W(e,a,l){const r=e.findIndex(h=>h[l.value]===a),n=R(e,r);return e[n]}function je(e,a,l){const r=[];let n={[a.children]:e},h=0;for(;n&&n[a.children];){const g=n[a.children],b=l.value[h];if(n=Pe(b)?W(g,b,a):void 0,!n&&g.length){const v=ce(g)[a.value];n=W(g,v,a)}h++,r.push(g)}return r}function qe(e){const{transform:a}=window.getComputedStyle(e),l=a.slice(7,a.length-1).split(", ")[5];return Number(l)}function Ge(e){return D({text:"text",value:"value",children:"children"},e)}const le=200,ae=300,ze=15,[de,J]=K("picker-column"),me=Symbol(de);var Je=L({name:de,props:{value:q,fields:U(Object),options:A(),readonly:Boolean,allowHtml:Boolean,optionHeight:U(Number),swipeDuration:U(q),visibleOptionNum:U(q)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:l}){let r,n,h,g,b;const v=C(),y=C(),f=C(0),p=C(0),k=Be(),T=()=>e.options.length,E=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,m=c=>{let t=R(e.options,c);const o=-t*e.optionHeight,i=()=>{t>T()-1&&(t=R(e.options,c));const S=e.options[t][e.fields.value];S!==e.value&&a("change",S)};r&&o!==f.value?b=i:i(),f.value=o},s=()=>e.readonly||!e.options.length,w=c=>{r||s()||(b=null,p.value=le,m(c),a("clickOption",e.options[c]))},x=c=>Q(Math.round(-c/e.optionHeight),0,T()-1),_=V(()=>x(f.value)),H=(c,t)=>{const o=Math.abs(c/t);c=f.value+o/.003*(c<0?-1:1);const i=x(c);p.value=+e.swipeDuration,m(i)},P=()=>{r=!1,p.value=0,b&&(b(),b=null)},N=c=>{if(!s()){if(k.start(c),r){const t=qe(y.value);f.value=Math.min(0,t-E())}p.value=0,n=f.value,h=Date.now(),g=n,b=null}},d=c=>{if(s())return;k.move(c),k.isVertical()&&(r=!0,ue(c,!0));const t=Q(n+k.deltaY.value,-(T()*e.optionHeight),e.optionHeight),o=x(t);o!==_.value&&a("scrollInto",e.options[o]),f.value=t;const i=Date.now();i-h>ae&&(h=i,g=t)},B=()=>{if(s())return;const c=f.value-g,t=Date.now()-h;if(t<ae&&Math.abs(c)>ze){H(c,t);return}const i=x(f.value);p.value=le,m(i),setTimeout(()=>{r=!1},0)},I=()=>{const c={height:`${e.optionHeight}px`};return e.options.map((t,o)=>{const i=t[e.fields.text],{disabled:S}=t,$=t[e.fields.value],ve={role:"button",style:c,tabindex:S?-1:0,class:[J("item",{disabled:S,selected:$===e.value}),t.className],onClick:()=>w(o)},fe={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:i};return u("li",ve,[l.option?l.option(t,o):u("div",fe,null)])})};return se(me),re({stopMomentum:P}),pe(()=>{const c=r?Math.floor(-f.value/e.optionHeight):e.options.findIndex(i=>i[e.fields.value]===e.value),t=R(e.options,c),o=-t*e.optionHeight;r&&t<c&&P(),f.value=o}),ie("touchmove",d,{target:v}),()=>u("div",{ref:v,class:J(),onTouchstartPassive:N,onTouchend:B,onTouchcancel:B},[u("ul",{ref:y,style:{transform:`translate3d(0, ${f.value+E()}px, 0)`,transitionDuration:`${p.value}ms`,transitionProperty:p.value?"all":"none"},class:J("wrapper"),onTransitionend:P},[I()])])}});const[Qe]=K("picker-toolbar"),Y={title:String,cancelButtonText:String,confirmButtonText:String},We=["cancel","confirm","title","toolbar"],Xe=Object.keys(Y);var Ze=L({name:Qe,props:Y,emits:["confirm","cancel"],setup(e,{emit:a,slots:l}){const r=()=>{if(l.title)return l.title();if(e.title)return u("div",{class:[O("title"),"van-ellipsis"]},[e.title])},n=()=>a("cancel"),h=()=>a("confirm"),g=()=>{const v=e.cancelButtonText||ne("cancel");return u("button",{type:"button",class:[O("cancel"),ee],onClick:n},[l.cancel?l.cancel():v])},b=()=>{const v=e.confirmButtonText||ne("confirm");return u("button",{type:"button",class:[O("confirm"),ee],onClick:h},[l.confirm?l.confirm():v])};return()=>u("div",{class:O("toolbar")},[l.toolbar?l.toolbar():[g(),r(),b()]])}});const[et,wt]=K("picker-group"),tt=Symbol(et);D({tabs:A(),activeTab:F(0),nextStepText:String},Y);const nt=D({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:F(44),showToolbar:Ee,swipeDuration:F(1e3),visibleOptionNum:F(6)},Y),ot=D({},nt,{columns:A(),modelValue:A(),toolbarPosition:Ie("top"),columnsFieldNames:Object});var lt=L({name:Ke,props:ot,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:l}){const r=C(),n=C(e.modelValue.slice(0)),{parent:h}=se(tt),{children:g,linkChildren:b}=Me(me);b();const v=V(()=>Ge(e.columnsFieldNames)),y=V(()=>De(e.optionHeight)),f=V(()=>Ye(e.columns,v.value)),p=V(()=>{const{columns:t}=e;switch(f.value){case"multiple":return t;case"cascade":return je(t,v.value,n);default:return[t]}}),k=V(()=>p.value.some(t=>t.length)),T=V(()=>p.value.map((t,o)=>W(t,n.value[o],v.value))),E=V(()=>p.value.map((t,o)=>t.findIndex(i=>i[v.value.value]===n.value[o]))),m=(t,o)=>{if(n.value[t]!==o){const i=n.value.slice(0);i[t]=o,n.value=i}},s=()=>({selectedValues:n.value.slice(0),selectedOptions:T.value,selectedIndexes:E.value}),w=(t,o)=>{m(o,t),f.value==="cascade"&&n.value.forEach((i,S)=>{const $=p.value[S];oe($,i,v.value)||m(S,$.length?$[0][v.value.value]:void 0)}),X(()=>{a("change",D({columnIndex:o},s()))})},x=(t,o)=>{const i={columnIndex:o,currentOption:t};a("clickOption",D(s(),i)),a("scrollInto",i)},_=()=>{g.forEach(o=>o.stopMomentum());const t=s();return X(()=>{a("confirm",t)}),t},H=()=>a("cancel",s()),P=()=>p.value.map((t,o)=>u(Je,{value:n.value[o],fields:v.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:y.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:i=>w(i,o),onClickOption:i=>x(i,o),onScrollInto:i=>{a("scrollInto",{currentOption:i,columnIndex:o})}},{option:l.option})),N=t=>{if(k.value){const o={height:`${y.value}px`},i={backgroundSize:`100% ${(t-y.value)/2}px`};return[u("div",{class:O("mask"),style:i},null),u("div",{class:[He,O("frame")],style:o},null)]}},d=()=>{const t=y.value*+e.visibleOptionNum,o={height:`${t}px`};return u("div",{ref:r,class:O("columns"),style:o},[P(),N(t)])},B=()=>{if(e.showToolbar&&!h)return u(Ze,he(te(e,Xe),{onConfirm:_,onCancel:H}),te(l,We))};j(p,t=>{t.forEach((o,i)=>{o.length&&!oe(o,n.value[i],v.value)&&m(i,ce(o)[v.value.value])})},{immediate:!0});let I;return j(()=>e.modelValue,t=>{!G(t,n.value)&&!G(t,I)&&(n.value=t.slice(0),I=t.slice(0))},{deep:!0}),j(n,t=>{G(t,e.modelValue)||(I=t.slice(0),a("update:modelValue",I))},{immediate:!0}),ie("touchmove",ue,{target:r}),re({confirm:_,getSelectedOptions:()=>T.value}),()=>{var t,o;return u("div",{class:O()},[e.toolbarPosition==="top"?B():null,e.loading?u($e,{class:O("loading")},null):null,(t=l["columns-top"])==null?void 0:t.call(l),d(),(o=l["columns-bottom"])==null?void 0:o.call(l),e.toolbarPosition==="bottom"?B():null])}}});const at=Ne(lt),st={class:"login-view"},it={style:{margin:"16px"}},ut=L({__name:"index",setup(e){const a=Ve(),l=ge(),r=C(!1),n=be({phone:"",password:"",password1:"",phoneCode:"",username:"",gender:""});function h({selectedValues:m}){n.gender=m[0],r.value=!1}const g=m=>m.length<6?"密码最少6位":!0,b=m=>m!==n.password?"两次密码不同":!0,v=m=>{k.value=m,f.value=!0;const s=Re({message:"加载中...",forbidClick:!0,duration:0});Oe(m,n.phone).then(_=>{z({type:"success",message:"验证码已发送"})}).catch(_=>{z({type:"fail",message:_.message||"系统错误"})}).finally(s.close);let w=60;const x=setInterval(()=>{if(w==0){clearInterval(x),p.value="重新发送",f.value=!1;return}p.value=`${w}秒后发送`,w--},1e3)},y=C(!1),f=C(!1),p=C("发送验证码"),k=C(""),T=C(!1),E=()=>{T.value=!0,ke(n).then(m=>{a.login(m),l.push({name:"Mine"})}).catch(m=>{z({type:"fail",message:m.message,duration:1500})}).finally(()=>T.value=!1)};return(m,s)=>{const w=Ae,x=Ue,_=Le,H=Se,P=at,N=Fe;return we(),Ce("div",st,[u(H,{onSubmit:E},{default:M(()=>[u(_,{inset:""},{default:M(()=>[u(w,{modelValue:n.phone,"onUpdate:modelValue":s[0]||(s[0]=d=>n.phone=d),rules:[{required:!0,message:"请填写正确手机号",pattern:/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/}],maxlength:11,label:"手机号",name:"phone",placeholder:"手机号"},null,8,["modelValue"]),u(w,{modelValue:n.username,"onUpdate:modelValue":s[1]||(s[1]=d=>n.username=d),rules:[{required:!0,message:"请填写用户名"}],maxlength:10,label:"用户名",name:"phone",placeholder:"用户名"},null,8,["modelValue"]),u(w,{modelValue:n.gender,"onUpdate:modelValue":s[2]||(s[2]=d=>n.gender=d),"is-link":"",readonly:"",label:"性别",placeholder:"性别",onClick:s[3]||(s[3]=d=>r.value=!0)},null,8,["modelValue"]),u(w,{modelValue:n.password,"onUpdate:modelValue":s[4]||(s[4]=d=>n.password=d),rules:[{validator:g}],type:"password",label:"密码",name:"password",placeholder:"密码"},null,8,["modelValue","rules"]),u(w,{modelValue:n.password1,"onUpdate:modelValue":s[5]||(s[5]=d=>n.password1=d),rules:[{validator:b}],type:"password",label:"确认密码",name:"password",placeholder:"确认密码"},null,8,["modelValue","rules"]),u(w,{modelValue:n.phoneCode,"onUpdate:modelValue":s[7]||(s[7]=d=>n.phoneCode=d),label:"手机验证码",maxlength:"4",type:"digit",name:"imageCode",placeholder:"手机验证码"},{extra:M(()=>[u(x,{size:"mini",type:"primary",disabled:f.value,onClick:s[6]||(s[6]=d=>{y.value=!0})},{default:M(()=>[Z(ye(p.value),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),xe("div",it,[u(x,{loading:T.value,block:"","native-type":"submit",disabled:n.phoneCode.length!==4,round:"",type:"primary"},{default:M(()=>[Z("注册 ")]),_:1},8,["loading","disabled"])])]),_:1}),u(_e,{show:y.value,"onUpdate:show":s[8]||(s[8]=d=>y.value=d),onSuccess:v},null,8,["show"]),u(N,{show:r.value,"onUpdate:show":s[10]||(s[10]=d=>r.value=d),round:"",position:"bottom"},{default:M(()=>[u(P,{columns:[{text:"女",value:"女"},{text:"男",value:"男"}],onCancel:s[9]||(s[9]=d=>r.value=!1),onConfirm:h})]),_:1},8,["show"])])}}});const Ct=Te(ut,[["__scopeId","data-v-66fc7c52"]]);export{Ct as default};
