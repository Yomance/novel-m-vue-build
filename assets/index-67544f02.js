import{d as V,r as d,h as G,i as O,e as i,n as X,o as l,g as p,w as g,c as L,f as U,F as N,b as S,_ as E,j,t as A,k as J,u as F,l as K,m as B}from"./index-4fe7824b.js";import{h as R}from"./index-2f1714f2.js";import{S as Q,a as Z}from"./index-107c1d2e.js";import{B as ee}from"./index-28b7cf06.js";import{S as M}from"./index-29569b89.js";import{t as te}from"./page-64bb3939.js";import{c as ae,m as I,n as se,a as ne,b as oe,g as le,p as re,w as ce,I as ie}from"./file-2a06de25.js";import{N as ue}from"./index-6afe34d9.js";import{u as de,L as W}from"./index-74f31b2d.js";import{S as _e}from"./index-57953903.js";import{L as me}from"./index-081089d8.js";import"./index-4984d8d9.js";import"./index-a9a9e208.js";import"./use-id-b193c290.js";const[he,x,fe]=ae("pull-refresh"),Y=50,ve=["pulling","loosing","success"],pe={disabled:Boolean,modelValue:Boolean,headHeight:I(Y),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:se,successDuration:I(500),animationDuration:I(300)};var ge=V({name:he,props:pe,emits:["change","refresh","update:modelValue"],setup(t,{emit:m,slots:r}){let s;const u=d(),h=d(),c=ne(u),a=G({status:"normal",distance:0,duration:0}),f=de(),P=()=>{if(t.headHeight!==Y)return{height:`${t.headHeight}px`}},k=()=>a.status!=="loading"&&a.status!=="success"&&!t.disabled,T=e=>{const n=+(t.pullDistance||t.headHeight);return e>n&&(e<n*2?e=n+(e-n)/2:e=n*1.5+(e-n*2)/4),Math.round(e)},_=(e,n)=>{const b=+(t.pullDistance||t.headHeight);a.distance=e,n?a.status="loading":e===0?a.status="normal":e<b?a.status="pulling":a.status="loosing",m("change",{status:a.status,distance:e})},y=()=>{const{status:e}=a;return e==="normal"?"":t[`${e}Text`]||fe(e)},w=()=>{const{status:e,distance:n}=a;if(r[e])return r[e]({distance:n});const b=[];return ve.includes(e)&&b.push(i("div",{class:x("text")},[y()])),e==="loading"&&b.push(i(W,{class:x("loading")},{default:y})),b},o=()=>{a.status="success",setTimeout(()=>{_(0)},+t.successDuration)},v=e=>{s=le(c.value)===0,s&&(a.duration=0,f.start(e))},$=e=>{k()&&v(e)},z=e=>{if(k()){s||v(e);const{deltaY:n}=f;f.move(e),s&&n.value>=0&&f.isVertical()&&(re(e),_(T(n.value)))}},D=()=>{s&&f.deltaY.value&&k()&&(a.duration=+t.animationDuration,a.status==="loosing"?(_(+t.headHeight,!0),m("update:modelValue",!0),X(()=>m("refresh"))):_(0))};return O(()=>t.modelValue,e=>{a.duration=+t.animationDuration,e?_(+t.headHeight,!0):r.success||t.successText?o():_(0,!1)}),oe("touchmove",z,{target:h}),()=>{var e;const n={transitionDuration:`${a.duration}ms`,transform:a.distance?`translate3d(0,${a.distance}px, 0)`:""};return i("div",{ref:u,class:x()},[i("div",{ref:h,class:x("track"),style:n,onTouchstartPassive:$,onTouchend:D,onTouchcancel:D},[i("div",{class:x("head"),style:P()},[w()]),(e=r.default)==null?void 0:e.call(r)])])}}});const ke=ce(ge),be=["src"],xe=V({__name:"HomeBanner",props:{value:{type:Array,default:[]}},setup(t){const m=r=>{const{src:s}=r;if(s){if(s.startsWith("http")||s.startsWith("//")){window.open(s);return}window.location.href=s}};return(r,s)=>{const u=Z,h=Q;return l(),p(h,{autoplay:2e3,class:"home-banner","indicator-color":"white"},{default:g(()=>[(l(!0),L(N,null,U(t.value,c=>(l(),p(u,{class:"banner-item",onClick:a=>m(c)},{default:g(()=>[S("img",{src:c.img,alt:"",class:"banner-image"},null,8,be)]),_:2},1032,["onClick"]))),256))]),_:1})}}});const Se=E(xe,[["__scopeId","data-v-c9595aef"]]),Te={class:"home-card"},ye={class:"header"},we={class:"title"},De={class:"desc"},He={class:"right-btn"},Be=V({__name:"HomeCard",props:{books:{type:Object,default:[]},title:{type:String,required:!0},desc:String},setup(t){return j(),(m,r)=>{const s=M;return l(),L("div",Te,[S("div",ye,[S("div",we,A(t.title),1),S("div",De,A(t.desc),1),S("div",He,[J(m.$slots,"right",{},void 0,!0)])]),i(s,{class:"body",direction:"vertical",fill:"",size:"16px"},{default:g(()=>[(l(!0),L(N,null,U(t.books,u=>(l(),p(ee,{book:u},null,8,["book"]))),256))]),_:1})])}}});const C=E(Be,[["__scopeId","data-v-1db4f5b6"]]),Ce=V({__name:"index",setup(t){let m=j();const r=d([]),s=d([]),u=d([]),h=d([]),c=d([]),a=d(!0),f=d(!1),P=()=>{w().finally(()=>f.value=!1)},k=d(!1),T=d(!1),_={current:0,size:8},y=()=>{R.get("/home-page/r",{params:_}).then(o=>{_.current=o.current+1,_.size=o.size,c.value||(c.value=[]),c.value.push(...o.data),k.value=!1,o.data.length<o.size&&(T.value=!0)})};function w(){return R.get("/home-page").then(o=>{r.value=o.banners,s.value=o.hot,u.value=o.newBook,h.value=o.recommend,c.value=o.random})}return w().finally(()=>a.value=!1),(o,v)=>{const $=ie,z=ue,D=W,e=_e,n=M,b=me,q=ke;return l(),L(N,null,[i(z,{class:"header",fixed:"",title:"云鹏小说网",placeholder:""},{right:g(()=>[i($,{name:"search",size:"18",onClick:F(te)},null,8,["onClick"])]),_:1}),i(q,{modelValue:f.value,"onUpdate:modelValue":v[2]||(v[2]=H=>f.value=H),"head-height":66,"success-duration":800,class:"home-view no-scroll-bar","success-text":"刷新成功",onRefresh:P},{default:g(()=>[i(b,{loading:k.value,"onUpdate:loading":v[1]||(v[1]=H=>k.value=H),finished:T.value,"immediate-check":!1,"finished-text":"没有更多了",onLoad:y},{default:g(()=>[a.value?(l(),p(D,{key:0,size:"24px",vertical:""},{default:g(()=>[K("加载中...")]),_:1})):(l(),p(n,{key:1,direction:"vertical",fill:"",size:"16px"},{default:g(()=>[i(Se,{value:r.value},null,8,["value"]),i(e,{shape:"round",disabled:"",background:"transparent",placeholder:"请输入搜索关键词",onClick:v[0]||(v[0]=H=>F(m).push({name:"Search"}))}),s.value&&s.value.length?(l(),p(C,{key:0,books:s.value,desc:"根据你的喜好推荐",title:"全网爆款"},null,8,["books"])):B("",!0),u.value&&u.value.length?(l(),p(C,{key:1,books:u.value,desc:"最近新上架的好书",title:"新书推荐"},null,8,["books"])):B("",!0),h.value&&h.value.length?(l(),p(C,{key:2,books:h.value,desc:"根据你的喜好推荐",title:"完本推荐"},null,8,["books"])):B("",!0),c.value&&c.value.length?(l(),p(C,{key:3,books:c.value,desc:"根据你的喜好推荐",title:"猜你喜欢"},null,8,["books"])):B("",!0)]),_:1}))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])],64)}}});const We=E(Ce,[["__scopeId","data-v-7a02d16b"]]);export{We as default};
